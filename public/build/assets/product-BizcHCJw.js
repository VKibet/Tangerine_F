document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("productPage");if(!e)return;const o=e.dataset.productId,i=parseInt(e.dataset.stock??"0",10),n=e.dataset.csrf,l=e.dataset.cartUrl,f=e.dataset.wishlistUrl,r=document.getElementById("quantity"),c=document.getElementById("addToCartBtn"),u=document.getElementById("wishlistBtn"),y=c?.querySelector(".loader");if(!r||!c)return;const h=e.querySelector("[data-qty-minus]"),E=e.querySelector("[data-qty-plus]");h?.addEventListener("click",()=>{const t=parseInt(r.value,10)||1;r.value=Math.max(1,t-1)}),E?.addEventListener("click",()=>{const t=parseInt(r.value,10)||1;r.value=Math.min(i||t+1,t+1)});let m=!1;c.addEventListener("click",async()=>{if(!m){m=!0,c.disabled=!0,y?.classList.remove("hidden");try{const s=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n,Accept:"application/json"},body:JSON.stringify({product_id:o,quantity:parseInt(r.value,10)||1})})).json();s?.success?(L(s.cart_count),a(s.message||"Added to cart","success")):a(s?.message||"Failed to add to cart","error")}catch{a("Network error. Please try again.","error")}finally{m=!1,c.disabled=!1,y?.classList.add("hidden")}}}),u&&f&&u.addEventListener("click",async()=>{try{const t=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n,Accept:"application/json"},body:JSON.stringify({product_id:o})});if(t.status===401){a("Please login to use wishlist","info");return}if(!t.ok){a("Wishlist request failed","error");return}(await t.json()).added===!0?(u.classList.add("text-red-500"),a("Added to wishlist","success")):(u.classList.remove("text-red-500"),a("Removed from wishlist","info"))}catch(t){console.error(t),a("Wishlist error. Try again.","error")}});const d=document.getElementById("mainImage"),p=document.querySelectorAll(".thumbnail-image");d&&p.length&&p.forEach(t=>{const s=t.dataset.image;if(!s)return;const v=new Image;v.src=s,["mouseenter","click"].forEach(I=>{t.addEventListener(I,()=>{if(d.src===s)return;d.classList.add("opacity-50");const g=new Image;g.src=s,g.onload=()=>{d.src=s,d.classList.remove("opacity-50"),p.forEach(w=>w.classList.remove("border-blue-500")),t.classList.add("border-blue-500")}})})})});function L(e){const o=document.getElementById("cartCount");o&&typeof e<"u"&&(o.textContent=e)}function a(e,o="info"){const i=document.getElementById("toastContainer");if(!i)return;const n=document.createElement("div"),l={success:"bg-green-600",error:"bg-red-600",info:"bg-gray-800"};n.className=`${l[o]??l.info} text-white px-4 py-3 rounded shadow transition-opacity duration-300`,n.textContent=e,i.appendChild(n),setTimeout(()=>{n.classList.add("opacity-0"),setTimeout(()=>n.remove(),300)},3e3)}
